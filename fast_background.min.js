/**
 * Name:    FastBackground
 * Version: 1.1.1
 * Author:  Novojilov Pavel Andreevich
 * Support: http://SHOWYWEB.ru
 * License: MIT license. http://www.opensource.org/licenses/mit-license.php
 * Copyright (c) 2017 Pavel Novojilov
 */
var fast_background={timeout:null,timeout_size:0,cssobj:null,prepare_selector_hook:function(a){return a},resize_event:!0,ajax_url:window.location.href,max_img_load_stream:5,max_ajax_post_stream:1,_page_unloaded:!1,_fix_old_browsers:!1,update:function(a,t,e){var o=jQuery;if(-1===window.location.host.indexOf("yandex.net")){var r=[];clearTimeout(fast_background.timeout),fast_background.timeout=setTimeout(function(){if(0===fast_background.timeout_size&&(fast_background.timeout_size=1e3),fast_background.ajax_is_work>0)fast_background.timeout=setTimeout(arguments.callee.bind(this,a),fast_background.timeout_size);else{if(fast_background._page_unloaded=!1,"undefined"==typeof SW_BS){SW_BS={browser:{isLocalStorageSupported:"undefined"!=typeof localStorage,isMobile:{Android:!!navigator.userAgent.match(/Android/i),BlackBerry:!!navigator.userAgent.match(/BlackBerry|BB/i),iOS:!!navigator.userAgent.match(/iPhone|iPad|iPod/i),Windows:!!navigator.userAgent.match(/IEMobile/i)}}};var i=SW_BS.browser;if(i.isSessionStorageSupported="undefined"!=typeof sessionStorage,i.isSessionStorageSupported)try{sessionStorage.setItem("test_sessionStorage",1),sessionStorage.removeItem("test_sessionStorage")}catch(a){i.isLocalStorageSupported=!1,i.isSessionStorageSupported=!1}i.isMobile.any=i.isMobile.Android||i.isMobile.BlackBerry||i.isMobile.iOS||i.opera_mini||i.isMobile.Windows,i.isMobile.anyPhone=!!i.isMobile.any&&(!!navigator.userAgent.match(/iphone|ipod/i)||i.isMobile.Android&&!!navigator.userAgent.match(/mobile/i)||i.isMobile.BlackBerry&&!!!navigator.userAgent.match(/tablet/i)||i.isMobile.Windows),o("head").append('<style id="SW_BS" type="text/css"> .SW_BS_is_retina {display: none; opacity: 0; } @media only screen and (-Webkit-min-device-pixel-ratio: 1.5), only screen and (-moz-min-device-pixel-ratio: 1.5), only screen and (-o-min-device-pixel-ratio: 3 / 2), only screen and (min-device-pixel-ratio: 1.5), only screen and (-webkit-min-device-pixel-ratio: 3) {.SW_BS_is_retina {opacity: 1; }} </style>'),i.isRetinaDisplay=function(){if(void 0===o)return!1;if(i.error_css||i.isMobile.Android&&i.fullVersion<534||i.isMobile.BlackBerry&&i.fullVersion<537)return!1;o("body").append("<div id='test_SW_BS' class='is_retina'></div>");var a="1"==o("#test_.SW_BS_is_retina").css("opacity");return o("#test_SW_BS").remove(),o("#SW_BS").remove(),a}()}var s=0,n=function(a,t,e){if(s>=fast_background.max_ajax_post_stream)setTimeout(arguments.callee.bind(this,a,t,e),100);else{s++;o.post(fast_background.ajax_url.replace(window.location.hash,""),a,function(a){if(s--,!fast_background._page_unloaded){var o="<->ajax_complete<->";if(a.substring(a.length-o.length)!=o)return e?e(a):console.log("ERROR POST AJAX: "+a),void t(null);a=a.substring(0,a.length-o.length),t&&t(a)}}).fail(function(r,i,n){s--,fast_background._page_unloaded||(e?e("ERROR POST AJAX: <div style='white-space: pre-wrap; word-wrap:break-word;'>"+window.location.href+" "+(o.toJSON?o.toJSON(a):"")+"</div><br>ERROR TEXT: "+n):console.log("ERROR POST AJAX: "+n),t(null))})}},c=function(a){var t=a.attr("data-urls");return void 0===t?{}:(t=t.replace(/'/gi,'"'),t=o.parseJSON(t))},_=function(a){return void 0!==a.attr("data-urls")},u=0,d=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a,t){window.setTimeout(a,1e3/60)},l=function(a,t){var e=a.attr("id");if(e&&(e="#"+e),e||(e=a.is("body")?"fb_body":"fb_"+Math.random().toString(36).substr(2,9),a.attr("id",e),e="#"+e),t){e=e+(0===t.indexOf(":")?"":" ")+t}return e=fast_background.prepare_selector_hook(e)},b=function(a,t){var e=a.is("img")?fast_background.types.img_src:fast_background.types.b_url;switch(e){case fast_background.types.b_url:var o=t;if(o||(o=l(a)),void 0===fast_background.cssobj.obj[o])return"";var r=fast_background.cssobj.obj[o][e];return r?r.replace(/url\(['"]?|['"]?\)/g,""):"";case fast_background.types.img_src:return a.attr(e)}},f=function(a,t,e,o){e||(e=a.width()),o||(o=a.height());return"fast_background_cached_url_"+(e-=e%10)+"x"+(o-=o%10)+"_"+t},g=function(t,e,i,s,n,c,_){!function(a,t,e){if(u>=fast_background.max_img_load_stream)setTimeout(arguments.callee.bind(this,a,t,e),100);else if(a){u++;var o=new Image;o.onload=function(){u--,t&&t(o.naturalWidth,o.naturalHeight)},o.onerror=function(a){return u--,a.preventDefault(),a.stopPropagation(),e&&e(),!1},a.indexOf("!important"),o.src=a}else e&&e()}(e,function(t,_){if(SW_BS.browser.isLocalStorageSupported)if(-1===e.indexOf("default_"))localStorage.setItem(c,e);else{var u="tmp_width"+(s?"_c_"+n:""),b="tmp_height"+(s?"_c_"+n:"");i.removeData(u),i.removeData(b)}!function(t,e,i){var s=e.is("img")?fast_background.types.img_src:fast_background.types.b_url;try{switch(s){case fast_background.types.b_url:var n=i;n||(n=l(e)),void 0===fast_background.cssobj.obj[n]&&(fast_background.cssobj.obj[n]={});var c=fast_background.cssobj.obj[n][s]&&-1!==fast_background.cssobj.obj[n][s].indexOf(" !important");c||-1===r.indexOf(n)||(c=!0),fast_background.cssobj.obj[n][s]="url("+t+")"+(c?" !important":""),fast_background.cssobj.update(),c||(fast_background._fix_old_browsers||"none"!=o(n).css("background-image")||(fast_background._fix_old_browsers=!0),fast_background._fix_old_browsers&&(fast_background.cssobj.obj[n].backgroundImage="url("+t+")",fast_background.cssobj.update()));break;case fast_background.types.img_src:e.attr(s,t),d(function(){var a=o(window).width(),t=e.width();(a>500&&t>a||SW_BS.browser.isMobile.anyPhone&&t<10)&&e.css("width","100%")},e[0])}}catch(a){}fast_background.ajax_is_work--,fast_background.ajax_is_work<1&&(fast_background.is_init?a&&a():(fast_background.is_init=!0,fast_background.update(a)))}(e,i,s)},function(){localStorage.removeItem(c),function(t,e){switch(t.is("img")?fast_background.types.img_src:fast_background.types.b_url){case fast_background.types.b_url:var o=e;o||(o=l(t)),void 0===fast_background.cssobj.obj[o]&&(fast_background.cssobj.obj[o]={}),fast_background.cssobj.update();break;case fast_background.types.img_src:}fast_background.ajax_is_work--,fast_background.ajax_is_work<1&&(fast_background.is_init?a&&a():(fast_background.is_init=!0,fast_background.update(a)))}(i,s)})};null===fast_background.cssobj&&(fast_background.cssobj=cssobj({}));var p=o(".fast_background").toArray();p.length<1&&a&&a();var m,k,w=[];for(k=0;k<p.length;k++)!function(a){w.push(a);var t=null;if(!a.is_fb_class&&_(a)){var e=c(a);for(var r in e)if(e.hasOwnProperty(r)){var i=e[r];t=l(a,r);var s=o(t.replace(":hover","").replace(":active","").replace(":focus",""));s.length>0&&(s=s.eq(0)),w.push({is_fb_class:!0,first_elem:s,url:i,fb_selector:t})}}}(m=p[k].is_fb_class?p[k]:o(p[k]));for(fast_background.ajax_is_work=w.length,k=0;k<w.length;k++)!function(a){var i=null,s=null,c=null,_=!1,u=null;if(a.is_fb_class)_=!0,u=m.first_elem,c=a.url,i=a.fb_selector,s=i?i.replace(/ |>|\*|\(|\)|\+|\@/gi,"_"):"",a=a.first_elem;else{if(!(c=a.attr("data-url")))return void fast_background.ajax_is_work--;i=null}var d=a.is("img")?fast_background.types.img_src:fast_background.types.b_url;if(d===fast_background.types.b_url){var p=i;if(p||(p=l(a)),void 0===fast_background.cssobj.obj[p]||void 0===fast_background.cssobj.obj[p][d]){fast_background.cssobj.obj[p]={};-1!==c.indexOf(" !important")&&r.push(p)}c=c.replace(" !important","")}d!==fast_background.types.img_src||a.attr("src")||a.attr("src","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQYV2NgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII=");var k=null,w=a.width(),h=a.height(),v=f(a,c,w,h);if(SW_BS.browser.isLocalStorageSupported&&!e&&(k=localStorage.getItem(v)))g(0,k,a,i,s,v);else{0===a.length&&(a=o(i.replace(/(\:| ).*$/gi,"")));var S="false",y=a.is("img")?"cover":a.css("background-size");if(_&&0===u.length&&(y="contain"),"cover"===y&&(S="true"),"cover"!==y&&"contain"!==y){var A=/^(|(\d*)(px|%|auto)) (|(\d*)(px|%|auto))$/i,j=y.match(A);null==j&&(A=/^(|(\d*)(px|%|auto))$/i,j=y.match(A));var x=!1,B=!1;if(null!=j){var O=a;d==fast_background.types.img_src&&(O=a.parent()),"auto"!=j[3].toLowerCase()?(w=parseInt(j[2]),"%"==j[3].toLowerCase()&&(w>=100&&(S="true"),w=O.width()/100*w)):x=!0,7==j.length&&"auto"!=j[6].toLowerCase()?(h=parseInt(j[5]),"%"==j[6].toLowerCase()&&(h>=100&&(S="true"),h=O.height()/100*h)):(7==j.length||x)&&(B=!0)}x&&B&&(w=o(window).width(),h=o(window).height())}if(SW_BS.browser.isRetinaDisplay&&(w*=2,h*=2),w+=150,h+=150,!e){var W="tmp_width"+(_?"_c_"+s:""),R="tmp_height"+(_?"_c_"+s:""),M=parseInt(a.data(W));M||(M=0);var z=parseInt(a.data(R));if(z||(z=0),w<=M&&h<=z)return k=b(a,i),k=k.replace(" !important",""),void g(0,k,a,i,s,v);w>M?a.data(W,w):w=M,h>z?a.data(R,h):h=z}var I=w+"x"+h;_&&0===u.length&&(a=u),n({fast_background:"get_cached_url",web_url:c,cover_size:S,cont_size:I,other_size:fast_background.is_init||d===fast_background.types.img_src?"false":"true"},function(t){g(0,t,a,i,s,v)},t)}}(m=w[k].is_fb_class?w[k]:o(w[k]))}}.bind(this,a,t,e),fast_background.timeout_size)}},types:{b_url:"background-image",img_src:"src"},is_init:!1,ajax_is_work:0};!function(){var a=jQuery;a(function(){a(window).on("beforeunload.fast_background",function(a){fast_background._page_unloaded=!0});var t=a(window).width();a(window).resize(function(){if(!fast_background.resize_event)return!0;var e=a(window).width();SW_BS.browser.isMobile.any&&t===e||!fast_background.is_init||-1===window.location.host.indexOf("yandex.net")&&(t=a(window).width(),fast_background.update())})})}();