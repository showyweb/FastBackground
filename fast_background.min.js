/**
 * Name:    FastBackground
 * Version: 0.7.3
 * Author:  Novojilov Pavel Andreevich
 * Support: http://SHOWYWEB.ru
 * License: MIT license. http://www.opensource.org/licenses/mit-license.php
 * Copyright (c) 2017 Pavel Novojilov
 */
var fast_background={timeout:null,timeout_size:0,cssobj:null,prepare_selector_hook:function(a){return a},resize_event:!0,ajax_url:window.location.href,max_stream:5,_page_unloaded:!1,_fix_old_browsers:!1,update:function(a,t,e){var o=jQuery;if(-1==window.location.host.indexOf("yandex.net")){var r=[];clearTimeout(fast_background.timeout),fast_background.timeout=setTimeout(function(){if(0==fast_background.timeout_size&&(fast_background.timeout_size=1e3),fast_background.ajax_is_work>0)fast_background.timeout=setTimeout(arguments.callee.bind(this,a),fast_background.timeout_size);else{if(fast_background._page_unloaded=!1,"undefined"==typeof SW_BS){SW_BS={browser:{isLocalStorageSupported:"undefined"!=typeof localStorage,isMobile:{Android:!!navigator.userAgent.match(/Android/i),BlackBerry:!!navigator.userAgent.match(/BlackBerry|BB/i),iOS:!!navigator.userAgent.match(/iPhone|iPad|iPod/i),Windows:!!navigator.userAgent.match(/IEMobile/i)}}};var i=SW_BS.browser;if(i.isSessionStorageSupported="undefined"!=typeof sessionStorage,i.isSessionStorageSupported)try{sessionStorage.setItem("test_sessionStorage",1),sessionStorage.removeItem("test_sessionStorage")}catch(a){i.isLocalStorageSupported=!1,i.isSessionStorageSupported=!1}i.isMobile.any=i.isMobile.Android||i.isMobile.BlackBerry||i.isMobile.iOS||i.opera_mini||i.isMobile.Windows,i.isMobile.anyPhone=!!i.isMobile.any&&(!!navigator.userAgent.match(/iphone|ipod/i)||i.isMobile.Android&&!!navigator.userAgent.match(/mobile/i)||i.isMobile.BlackBerry&&!!!navigator.userAgent.match(/tablet/i)||i.isMobile.Windows),o("head").append('<style id="SW_BS" type="text/css"> .SW_BS_is_retina {display: none; opacity: 0; } @media only screen and (-Webkit-min-device-pixel-ratio: 1.5), only screen and (-moz-min-device-pixel-ratio: 1.5), only screen and (-o-min-device-pixel-ratio: 3 / 2), only screen and (min-device-pixel-ratio: 1.5), only screen and (-webkit-min-device-pixel-ratio: 3) {.SW_BS_is_retina {opacity: 1; }} </style>'),i.isRetinaDisplay=function(){if(void 0===o)return!1;if(i.error_css||i.isMobile.Android&&i.fullVersion<534||i.isMobile.BlackBerry&&i.fullVersion<537)return!1;o("body").append("<div id='test_SW_BS' class='is_retina'></div>");var a="1"==o("#test_.SW_BS_is_retina").css("opacity");return o("#test_SW_BS").remove(),o("#SW_BS").remove(),a}()}var s=function(a,t,e){o.post(fast_background.ajax_url.replace(window.location.hash,""),a,function(a){if(!fast_background._page_unloaded){var o="<->ajax_complete<->";if(a.substring(a.length-o.length)!=o)return e?e(a):console.log("ERROR POST AJAX: "+a),void t(null);a=a.substring(0,a.length-o.length),t&&t(a)}}).fail(function(r,i,s){fast_background._page_unloaded||(e?e("ERROR POST AJAX: <div style='white-space: pre-wrap; word-wrap:break-word;'>"+window.location.href+" "+(o.toJSON?o.toJSON(a):"")+"</div><br>ERROR TEXT: "+s):console.log("ERROR POST AJAX: "+s),t(null))})},n=function(a){var t=a.attr("data-urls");return void 0===t?{}:(t=t.replace(/'/gi,'"'),t=o.parseJSON(t))},c=function(a){return void 0!==a.attr("data-urls")},d=0,u=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a,t){window.setTimeout(a,1e3/60)};null===fast_background.cssobj&&(fast_background.cssobj=cssobj({}));var _=o(".fast_background").toArray();_.length<1&&a&&a();var b=function(a,t){var e=a.attr("id");if(e&&(e="#"+e),e||(e=a.is("body")?"fb_body":"fb_"+Math.random().toString(36).substr(2,9),a.attr("id",e),e="#"+e),t){e=e+(0===t.indexOf(":")?"":" ")+t}return e=fast_background.prepare_selector_hook(e)},l=function(a,t){var e=a.is("img")?fast_background.types.img_src:fast_background.types.b_url;switch(e){case fast_background.types.b_url:var o=t;if(o||(o=b(a)),void 0===fast_background.cssobj.obj[o])return"";var r=fast_background.cssobj.obj[o][e];return r?r.replace(/url\(['"]?|['"]?\)/g,""):"";case fast_background.types.img_src:return a.attr(e)}},g=function(a,t,e,o){e||(e=a.width()),o||(o=a.height());return"fast_background_cached_url_"+(e-=e%10)+"x"+(o-=o%10)+"_"+t},f=function(t,e,i,s,n,c){!function(a,t,e){if(d>fast_background.max_stream)setTimeout(arguments.callee.bind(this,a,t,e),100);else if(a){d++;var o=new Image;o.onload=function(){d--,t&&t(o.naturalWidth,o.naturalHeight)},o.onerror=function(a){return d--,a.preventDefault(),a.stopPropagation(),e&&e(),!1},o.src=a}else e&&e()}(e,function(t,c){SW_BS.browser.isLocalStorageSupported&&(-1===e.indexOf("default_")?localStorage.setItem(n,e):(i.removeData("tmp_width"+(s?"_c":"")),i.removeData("tmp_height"+(s?"_c":"")))),function(t,e,i){var s=e.is("img")?fast_background.types.img_src:fast_background.types.b_url;try{switch(s){case fast_background.types.b_url:var n=i;n||(n=b(e)),void 0===fast_background.cssobj.obj[n]&&(fast_background.cssobj.obj[n]={});var c=fast_background.cssobj.obj[n][s]&&-1!==fast_background.cssobj.obj[n][s].indexOf(" !important");c||-1===r.indexOf(n)||(c=!0),fast_background.cssobj.obj[n][s]="url("+t+")"+(c?" !important":""),fast_background.cssobj.update(),c||(fast_background._fix_old_browsers||"none"!=o(n).css("background-image")||(fast_background._fix_old_browsers=!0),fast_background._fix_old_browsers&&(fast_background.cssobj.obj[n].backgroundImage="url("+t+")",fast_background.cssobj.update()));break;case fast_background.types.img_src:e.attr(s,t),u(function(){var a=o(window).width(),t=e.width();(a>500&&t>a||SW_BS.browser.isMobile.anyPhone&&t<10)&&e.css("width","100%")},e[0])}}catch(a){}fast_background.ajax_is_work--,fast_background.ajax_is_work<1&&(fast_background.is_init?a&&a():(fast_background.is_init=!0,fast_background.update(a)))}(e,i,s)},function(){localStorage.removeItem(n),function(t,e){switch(t.is("img")?fast_background.types.img_src:fast_background.types.b_url){case fast_background.types.b_url:var o=e;o||(o=b(t)),void 0===fast_background.cssobj.obj[o]&&(fast_background.cssobj.obj[o]={}),fast_background.cssobj.update();break;case fast_background.types.img_src:}fast_background.ajax_is_work--,fast_background.ajax_is_work<1&&(fast_background.is_init?a&&a():(fast_background.is_init=!0,fast_background.update(a)))}(i,s)})};fast_background.ajax_is_work=_.length;for(var p=0;p<_.length;p++){var k=_[p].is_fb_class?_[p]:o(_[p]);!function(a){var i=null;if(!a.is_fb_class&&c(a)){var d=n(a);for(var u in d)if(d.hasOwnProperty(u)){var p=d[u];i=b(a,u);var m=o(i.replace(":hover","").replace(":active","").replace(":focus",""));m.length>0&&(m=m.eq(0)),_.push({is_fb_class:!0,first_elem:m,url:p,fb_selector:i}),fast_background.ajax_is_work++}}var w=null,h=!1,v=null;if(a.is_fb_class)h=!0,v=k.first_elem,w=a.url,i=a.fb_selector,a=a.first_elem;else{if(!(w=a.attr("data-url")))return void fast_background.ajax_is_work--;i=null}var S=a.is("img")?fast_background.types.img_src:fast_background.types.b_url;if(S==fast_background.types.b_url){var y=i;if(y||(y=b(a)),void 0===fast_background.cssobj.obj[y]||void 0===fast_background.cssobj.obj[y][S]){fast_background.cssobj.obj[y]={};-1!==w.indexOf(" !important")&&r.push(y)}w=w.replace(" !important","")}S!=fast_background.types.img_src||a.attr("src")||a.attr("src","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQYV2NgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII=");var A=null,j=a.width(),x=a.height(),B=g(a,w,j,x);if(SW_BS.browser.isLocalStorageSupported&&!e&&(A=localStorage.getItem(B)))f(0,A,a,i,B);else{0==a.length&&(a=o(i.replace(/(\:| ).*$/gi,"")));var O="false",W=a.is("img")?"contain":a.css("background-size");if(h&&0==v.length&&(W="contain"),"cover"==W&&(O="true"),"cover"!==W&&"contain"!==W){var R=/^(|(\d*)(px|%|auto)) (|(\d*)(px|%|auto))$/i,M=W.match(R);null==M&&(R=/^(|(\d*)(px|%|auto))$/i,M=W.match(R));var z=!1,I=!1;if(null!=M){var P=a;S==fast_background.types.img_src&&(P=a.parent()),"auto"!=M[3].toLowerCase()?(j=parseInt(M[2]),"%"==M[3].toLowerCase()&&(j>=100&&(O="true"),j=P.width()/100*j)):z=!0,7==M.length&&"auto"!=M[6].toLowerCase()?(x=parseInt(M[5]),"%"==M[6].toLowerCase()&&(x>=100&&(O="true"),x=P.height()/100*x)):(7==M.length||z)&&(I=!0)}z&&I&&(j=o(window).width(),x=o(window).height())}if(SW_BS.browser.isRetinaDisplay&&(j*=2,x*=2),j+=150,x+=150,!e){var T=parseInt(a.data("tmp_width"+(h?"_c":"")));T||(T=0);var C=parseInt(a.data("tmp_height"+(h?"_c":"")));if(C||(C=0),j<=T&&x<=C)return A=l(a,i),void f(0,A,a,i,B);j>T?a.data("tmp_width"+(h?"_c":""),j):j=T,x>C?a.data("tmp_height"+(h?"_c":""),x):x=C}var E=j+"x"+x;h&&0==v.length&&(a=v),"/download/kat.png"===w&&console.log(""),s({fast_background:"get_cached_url",web_url:w,cover_size:O,cont_size:E,other_size:fast_background.is_init||S===fast_background.types.img_src?"false":"true"},function(t){f(0,t,a,i,B)},t)}}(k)}}}.bind(this,a,t,e),fast_background.timeout_size)}},types:{b_url:"background-image",img_src:"src"},is_init:!1,ajax_is_work:0};!function(){var a=jQuery;a(function(){a(window).on("beforeunload.fast_background",function(a){fast_background._page_unloaded=!0});var t=a(window).width();a(window).resize(function(){if(!fast_background.resize_event)return!0;var e=a(window).width();SW_BS.browser.isMobile.any&&t===e||!fast_background.is_init||-1===window.location.host.indexOf("yandex.net")&&(t=a(window).width(),fast_background.update())})})}();