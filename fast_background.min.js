/**
 * Name:    FastBackground
 * Version: 0.5.0
 * Author:  Novojilov Pavel Andreevich
 * Support: http://SHOWYWEB.ru
 * License: MIT license. http://www.opensource.org/licenses/mit-license.php
 * Copyright (c) 2017 Pavel Novojilov
 */
var fast_background={timeout:null,timeout_size:0,cssobj:null,prepare_selector_hook:function(t){return t},resize_event:!0,ajax_url:window.location.href,_page_unloaded:!1,_fix_old_browsers:!1,update:function(t,a,o){-1==window.location.host.indexOf("yandex.net")&&(clearTimeout(fast_background.timeout),fast_background.timeout=setTimeout(function(){if(0==fast_background.timeout_size&&(fast_background.timeout_size=1e3),fast_background.ajax_is_work>0)fast_background.timeout=setTimeout(arguments.callee.bind(this,t),fast_background.timeout_size);else{if(fast_background._page_unloaded=!1,"undefined"==typeof SW_BS){SW_BS={browser:{isLocalStorageSupported:"undefined"!=typeof localStorage,isMobile:{Android:function(){return!!navigator.userAgent.match(/Android/i)}(),BlackBerry:function(){return!!navigator.userAgent.match(/BlackBerry|BB/i)}(),iOS:function(){return!!navigator.userAgent.match(/iPhone|iPad|iPod/i)}(),Windows:function(){return!!navigator.userAgent.match(/IEMobile/i)}()}}};var e=SW_BS.browser;if(e.isSessionStorageSupported="undefined"!=typeof sessionStorage,e.isSessionStorageSupported)try{sessionStorage.setItem("test_sessionStorage",1),sessionStorage.removeItem("test_sessionStorage")}catch(t){e.isLocalStorageSupported=!1,e.isSessionStorageSupported=!1}e.isMobile.any=function(){return e.isMobile.Android||e.isMobile.BlackBerry||e.isMobile.iOS||e.opera_mini||e.isMobile.Windows}(),e.isMobile.anyPhone=function(){return!!e.isMobile.any&&(!!navigator.userAgent.match(/iphone|ipod/i)||e.isMobile.Android&&!!navigator.userAgent.match(/mobile/i)||e.isMobile.BlackBerry&&!!!navigator.userAgent.match(/tablet/i)||e.isMobile.Windows)}(),$("head").append('<style id="SW_BS" type="text/css"> .SW_BS_is_retina {display: none; opacity: 0; } @media only screen and (-Webkit-min-device-pixel-ratio: 1.5), only screen and (-moz-min-device-pixel-ratio: 1.5), only screen and (-o-min-device-pixel-ratio: 3 / 2), only screen and (min-device-pixel-ratio: 1.5), only screen and (-webkit-min-device-pixel-ratio: 3) {.SW_BS_is_retina {opacity: 1; }} </style>'),e.isRetinaDisplay=function(){if("undefined"==typeof $)return!1;if(e.error_css||e.isMobile.Android&&e.fullVersion<534||e.isMobile.BlackBerry&&e.fullVersion<537)return!1;$("body").append("<div id='test_SW_BS' class='is_retina'></div>");var t="1"==$("#test_.SW_BS_is_retina").css("opacity");return $("#test_SW_BS").remove(),$("#SW_BS").remove(),t}()}var r=function(t,a,o){$.post(fast_background.ajax_url.replace(window.location.hash,""),t,function(t){if(!fast_background._page_unloaded){var e="<->ajax_complete<->";if(t.substring(t.length-e.length)!=e)return o?o(t):console.log("ERROR POST AJAX: "+t),void a(null);t=t.substring(0,t.length-e.length),a&&a(t)}}).fail(function(e,r,i){fast_background._page_unloaded||(o?o("ERROR POST AJAX: <div style='white-space: pre-wrap; word-wrap:break-word;'>"+window.location.href+" "+($.toJSON?$.toJSON(t):"")+"</div><br>ERROR TEXT: "+i):console.log("ERROR POST AJAX: "+i),a(null))})},i={get_all:function(t){var a=t.attr("data-urls");return void 0===a?{}:(a=a.replace(/'/gi,'"'),a=$.parseJSON(a))},get:function(t,a){return this.get_all(t)[a]},set_all:function(t,a){var o=$.toJSON(a);o=o.replace(/\"/gi,"'"),t.attr("data-urls",o),isEmptyObject(a)&&this.del_all(t)},set:function(t,a,o){var e=this.get_all(t);e[a]=o,this.set_all(t,e)},del_all:function(t){t.removeAttr("data-urls")},del:function(t,a){var o=this.get_all(t);delete o[a],this.set_all(t,o)},all_exist:function(t){return void 0!==t.attr("data-urls")}},n=function(t,a,o){var e=new Image;e.onload=function(){a&&a()},e.onerror=function(t){return t.preventDefault(),t.stopPropagation(),o&&o(),!1},e.src=t},s=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t,a){window.setTimeout(t,1e3/60)}}();null===fast_background.cssobj&&(fast_background.cssobj=cssobj({}));var c=$(".fast_background").toArray();c.length<1&&t&&t();var u=function(t,a){var o=t.attr("id");return o&&(o="#"+o),o||(o=t.is("body")?"fb_body":"fb_"+Math.random().toString(36).substr(2,9),t.attr("id",o),o="#"+o),a&&(o=o+(0===a.indexOf(":")?"":" ")+a),o=fast_background.prepare_selector_hook(o)},d=function(a,o,e){var r=o.is("img")?fast_background.types.img_src:fast_background.types.b_url;try{switch(r){case fast_background.types.b_url:var i=e;i||(i=u(o)),void 0===fast_background.cssobj.obj[i]&&(fast_background.cssobj.obj[i]={});var n=fast_background.cssobj.obj[i][r]&&-1!==fast_background.cssobj.obj[i][r].indexOf(" !important");fast_background.cssobj.obj[i][r]="url("+a+")"+(n?" !important":""),fast_background.cssobj.update(),n||(fast_background._fix_old_browsers||"none"!=$(i).css("background-image")||(fast_background._fix_old_browsers=!0),fast_background._fix_old_browsers&&(fast_background.cssobj.obj[i].backgroundImage="url("+a+")",fast_background.cssobj.update()));break;case fast_background.types.img_src:o.attr(r,a),s(function(){var t=$(window).width(),a=o.width();(t>500&&a>t||SW_BS.browser.isMobile.anyPhone&&a<10)&&o.css("width","100%")},o[0])}}catch(t){}--fast_background.ajax_is_work<1&&(fast_background.is_init?t&&t():(fast_background.is_init=!0,fast_background.update(t)))},_=function(a,o){var e=a.is("img")?fast_background.types.img_src:fast_background.types.b_url;switch(e){case fast_background.types.b_url:var r=o||"#"+a.attr("id");void 0===fast_background.cssobj.obj[r]&&(fast_background.cssobj.obj[r]={});var i=fast_background.cssobj.obj[r][e]&&-1!==fast_background.cssobj.obj[r][e].indexOf(" !important");fast_background.cssobj.obj[r][e]="none"+(i?" !important":""),fast_background.cssobj.update();break;case fast_background.types.img_src:a.attr(e,"")}--fast_background.ajax_is_work<1&&(fast_background.is_init?t&&t():(fast_background.is_init=!0,fast_background.update(t)))},l=function(t,a,o,e){if(SW_BS.browser.isLocalStorageSupported&&fast_background.is_init){var r="fast_background_cached_url_"+t;localStorage.setItem(r,a)}n(a,function(){d(a,o,e)},function(){_(o,e)})};fast_background.ajax_is_work=c.length;for(var b=0;b<c.length;b++){var g=c[b].is_fb_class?c[b]:$(c[b]);!function(t){var e=null;if(!t.is_fb_class&&i.all_exist(t)){var n=i.get_all(t);for(var s in n)if(n.hasOwnProperty(s)){var d=n[s];e=u(t,s);var _=$(e);_.length>0&&(_=_.eq(0)),c.push({is_fb_class:!0,first_elem:_,url:d,fb_selector:e}),fast_background.ajax_is_work++}}var b=null,f=!1,p=null;if(t.is_fb_class)f=!0,p=g.first_elem,b=t.url,e=t.fb_selector,t=t.first_elem;else{if(!(b=t.attr("data-url")))return void fast_background.ajax_is_work--;e=null}var k=t.is("img")?fast_background.types.img_src:fast_background.types.b_url;if(k==fast_background.types.b_url){var w=e;if(w||(w=u(t)),void 0===fast_background.cssobj.obj[w]||void 0===fast_background.cssobj.obj[w][k]){fast_background.cssobj.obj[w]={},fast_background.cssobj.obj[w][k]={};var m=-1!==b.indexOf(" !important");fast_background.cssobj.obj[w][k]="none"+(m?" !important":"")}b=b.replace(" !important","")}k!=fast_background.types.img_src||t.attr("src")||t.attr("src","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQYV2NgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII=");var h=null;if(SW_BS.browser.isLocalStorageSupported&&!fast_background.is_init&&(h=localStorage.getItem("fast_background_cached_url_"+b)))l(b,h,t,e);else{0==t.length&&(t=$(e.replace(/(\:| ).*$/gi,"")));var v="false",S=t.is("img")?"contain":t.css("background-size");f&&0==p.length&&(S="contain"),"cover"==S&&(v="true");var A=t.width(),y=t.height();if("cover"!==S&&"contain"!==S){var j=/^(|(\d*)(px|%|auto)) (|(\d*)(px|%|auto))$/i,x=S.match(j);null==x&&(j=/^(|(\d*)(px|%|auto))$/i,x=S.match(j));var B=!1,O=!1;if(null!=x){var W=t;k==fast_background.types.img_src&&(W=t.parent()),"auto"!=x[3].toLowerCase()?(A=parseInt(x[2]),"%"==x[3].toLowerCase()&&(A>=100&&(v="true"),A=W.width()/100*A)):B=!0,7==x.length&&"auto"!=x[6].toLowerCase()?(y=parseInt(x[5]),"%"==x[6].toLowerCase()&&(y>=100&&(v="true"),y=W.height()/100*y)):(7==x.length||B)&&(O=!0)}B&&O&&(A=$(window).width(),y=$(window).height())}if(SW_BS.browser.isRetinaDisplay&&(A*=2,y*=2),A+=150,y+=150,!o){var R=parseInt(t.data("tmp_width"+(f?"_c":"")));R||(R=0);var M=parseInt(t.data("tmp_height"+(f?"_c":"")));if(M||(M=0),A<=R&&y<=M&&SW_BS.browser.isLocalStorageSupported&&(h=localStorage.getItem("fast_background_cached_url_"+b),f&&0==p.length&&(t=p),h))return void l(b,h,t,e);A>R?t.data("tmp_width"+(f?"_c":""),A):A=R,y>M?t.data("tmp_height"+(f?"_c":""),y):y=M}var z=A+"x"+y;f&&0==p.length&&(t=p),r({fast_background:"get_cached_url",web_url:b,cover_size:v,cont_size:z,other_size:fast_background.is_init?"false":"true"},function(a){l(b,a,t,e)},a)}}(g)}}}.bind(this,t,a,o),fast_background.timeout_size))},types:{b_url:"background-image",img_src:"src"},is_init:!1,ajax_is_work:0};$(function(){$(window).on("beforeunload.fast_background",function(t){fast_background._page_unloaded=!0});var t=$(window).width();$(window).resize(function(){if(!fast_background.resize_event)return!0;var a=$(window).width();SW_BS.browser.isMobile.any&&t==a||!fast_background.is_init||-1==window.location.host.indexOf("yandex.net")&&(t=$(window).width(),fast_background.update())})});