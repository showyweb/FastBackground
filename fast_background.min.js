/**
 * Name:    FastBackground
 * Version: 1.3.12
 * Author:  Novojilov Pavel Andreevich
 * Support: https://github.com/showyweb/FastBackground
 * License: MIT license. http://www.opensource.org/licenses/mit-license.php
 * Copyright (c) 2017 Pavel Novojilov
 */
var fast_background={_timeout:null,timeout_size:0,cssobj:null,prepare_selector_hook:function(e){return e},resize_event:!0,ajax_url:window.location.href,max_ajax_post_stream:8,_page_unloaded:!1,_fix_old_browsers:!1,_ajax_is_work:0,_p_post_ajax_work_streams:0,_last_update_callbacks:[],_types:{b_url:"background-image",img_src:"src"},is_init:!1,_only_w_loaded:!1,update:function(e,t,o){function i(e,t,o){if(b._p_post_ajax_work_streams>=b.max_ajax_post_stream)setTimeout(arguments.callee.bind(this,e,t,o),100);else{b._p_post_ajax_work_streams++;f.post(b.ajax_url.replace(window.location.hash,""),e,function(e){if(b._p_post_ajax_work_streams--,!b._page_unloaded){var i="<->ajax_complete<->";if(e.substring(e.length-i.length)!==i)return o?o(e):console.log("ERROR POST AJAX: "+e),void t(null);e=e.substring(0,e.length-i.length),t&&t(e)}}).fail(function(i,a,r){b._p_post_ajax_work_streams--,b._page_unloaded||(o?o("ERROR POST AJAX: <div style='white-space: pre-wrap; word-wrap:break-word;'>"+window.location.href+" "+(f.toJSON?f.toJSON(e):"")+"</div><br>ERROR TEXT: "+r):console.log("ERROR POST AJAX: "+r),t(null))})}}function a(e,t){var o=e.attr("id");if(o&&(o="#"+o),o||(o=e.is("body")?"fb_body":"fb_"+Math.random().toString(36).substr(2,9),e.attr("id",o),o="#"+o),t){o=o+(0===t.indexOf(":")?"":" ")+t}return o=b.prepare_selector_hook(o)}function r(){if(b._ajax_is_work--,b._ajax_is_work<1)if(b.is_init){if(e||b._last_update_callbacks.length){e&&e();for(var i=0;i<b._last_update_callbacks.length;i++)b._last_update_callbacks[i]();b._last_update_callbacks=[]}}else b._only_w_loaded?b.is_init=!0:(b._only_w_loaded=!0,b.cssobj.update()),b.update(e,t,o)}function s(e,t,o){var i=t.is("img")?b._types.img_src:b._types.b_url;try{switch(i){case b._types.b_url:var s=o;s||(s=a(t)),void 0===b.cssobj.obj[s]&&(b.cssobj.obj[s]={});var n=b.cssobj.obj[s][i]&&-1!==b.cssobj.obj[s][i].indexOf(" !important");n||-1===S.indexOf(s)||(n=!0),b.cssobj.obj[s][i]="url("+e+")"+(n?" !important":""),b._only_w_loaded&&b.cssobj.update(),n||(b._fix_old_browsers||"none"!==f(s).css("background-image")||(b._fix_old_browsers=!0),b._fix_old_browsers&&(b.cssobj.obj[s].backgroundImage="url("+e+")",b.cssobj.update()));break;case b._types.img_src:t.attr(i,e),d(function(){var e=f(window).width(),o=t.width();(e>500&&o>e||SW_BS.browser.isMobile.anyPhone&&o<10)&&t.css("width","100%")},t[0])}}catch(e){}r()}function n(e,t){var o=e.is("img")?b._types.img_src:b._types.b_url;switch(o){case b._types.b_url:var i=t;if(i||(i=a(e)),void 0===b.cssobj.obj[i])return"";var r=b.cssobj.obj[i][o];return r?r.replace(/url\(['"]?|['"]?\)/g,""):"";case b._types.img_src:return e.attr(o)}}function _(e,t,o,i){o||(o=e.width()),i||(i=e.height());return"fast_background_cached_url_"+(o-=o%10)+"x"+(i-=i%10)+"_"+t}function l(e,t,o,i,n,_){!function(e,t,o){if(b._p_post_ajax_work_streams>=b.max_ajax_post_stream)setTimeout(arguments.callee.bind(this,e,t,o),100);else if(e){b._p_post_ajax_work_streams++;var i=new Image;i.onload=function(){b._p_post_ajax_work_streams--,t&&t(i.naturalWidth,i.naturalHeight)},i.onerror=function(e){return b._p_post_ajax_work_streams--,e.preventDefault(),e.stopPropagation(),o&&o(),!1},e.indexOf("!important"),i.src=e}else o&&o()}(t,function(e,a){if(SW_BS.browser.isLocalStorageSupported)if(-1===t.indexOf("default_"))localStorage.setItem(_,t);else{var r="tmp_width"+(i?"_c_"+n:""),l="tmp_height"+(i?"_c_"+n:"");o.removeData(r),o.removeData(l)}s(t,o,i)},function(){localStorage.removeItem(_),function(e,t){switch(e.is("img")?b._types.img_src:b._types.b_url){case b._types.b_url:var o=t;o||(o=a(e)),void 0===b.cssobj.obj[o]&&(b.cssobj.obj[o]={}),b._only_w_loaded&&b.cssobj.update();break;case b._types.img_src:}r()}(o,i)})}function c(e){g.push(e)}var d=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)},u=function(e){var t=e.attr("data-urls");return void 0===t?{}:(t=t.replace(/'/gi,'"'),t=f.parseJSON(t))},p=function(e){return void 0!==e.attr("data-urls")},f=jQuery,b=fast_background,g=[],w=f(window).height(),m=f(window).scrollTop(),h=m,v=w+m;if("undefined"==typeof SW_BS){SW_BS={browser:{isLocalStorageSupported:"undefined"!=typeof localStorage,isMobile:{Android:!!navigator.userAgent.match(/Android/i),BlackBerry:!!navigator.userAgent.match(/BlackBerry|BB/i),iOS:!!navigator.userAgent.match(/iPhone|iPad|iPod/i),Windows:!!navigator.userAgent.match(/IEMobile/i)}}};var y=SW_BS.browser;if(y.isSessionStorageSupported="undefined"!=typeof sessionStorage,y.isSessionStorageSupported)try{sessionStorage.setItem("test_sessionStorage",1),sessionStorage.removeItem("test_sessionStorage")}catch(e){y.isLocalStorageSupported=!1,y.isSessionStorageSupported=!1}y.isMobile.any=y.isMobile.Android||y.isMobile.BlackBerry||y.isMobile.iOS||y.opera_mini||y.isMobile.Windows,y.isMobile.anyPhone=!!y.isMobile.any&&(!!navigator.userAgent.match(/iphone|ipod/i)||y.isMobile.Android&&!!navigator.userAgent.match(/mobile/i)||y.isMobile.BlackBerry&&!navigator.userAgent.match(/tablet/i)||y.isMobile.Windows),f("head").append('<style id="SW_BS" type="text/css"> .SW_BS_is_retina {display: none; opacity: 0; } @media only screen and (-Webkit-min-device-pixel-ratio: 1.5), only screen and (-moz-min-device-pixel-ratio: 1.5), only screen and (-o-min-device-pixel-ratio: 3 / 2), only screen and (min-device-pixel-ratio: 1.5), only screen and (-webkit-min-device-pixel-ratio: 3) {.SW_BS_is_retina {opacity: 1; }} </style>'),y.isRetinaDisplay=function(){if(void 0===f)return!1;if(y.is_error_version||y.isMobile.Android&&y.fullVersion<534||y.isMobile.BlackBerry&&y.fullVersion<537)return!1;f("body").append("<div id='test_SW_BS' class='is_retina'></div>");var e="1"==f("#test_.SW_BS_is_retina").css("opacity");return f("#test_SW_BS").remove(),f("#SW_BS").remove(),e}()}if(-1===window.location.host.indexOf("yandex.net")){var S=[];if(b._p_post_ajax_work_streams=0,0===b.timeout_size&&(b.timeout_size=1e3),b._ajax_is_work>0)return e&&b._last_update_callbacks.push(e),clearTimeout(b._timeout),void(b._timeout=setTimeout(arguments.callee.bind(this,null,t),b.timeout_size));b._page_unloaded=!1,null===b.cssobj&&(b.cssobj=cssobj({}));var j=f(".fast_background").toArray(),A=[];for(x=0;x<j.length;x++)A.push(f(j[x]));j=A,A=null,j.length<1&&e&&e();var k,x;for(x=0;x<j.length;x++){c(j[x]);var B=null;if(!(k=j[x]).is_fb_class&&p(k)){var O=u(k);for(var W in O)if(O.hasOwnProperty(W)){var R=O[W];B=a(k,W);var z=f(B.replace(":hover","").replace(":active","").replace(":focus",""));z.length>0&&(z=z.eq(0)),c({is_fb_class:!0,first_elem:z,url:R,fb_selector:B})}}}b._ajax_is_work=g.length;var M=[];for(x=0;x<g.length;x++)!function(e){var r=null,c=null,d=null,u=!1,p=null;if(e.is_fb_class)u=!0,p=k.first_elem,d=e.url,r=e.fb_selector,c=r?r.replace(/ |>|\*|\(|\)|\+|\@/gi,"_"):"",e=e.first_elem;else{if(!(d=e.attr("data-url")))return void b._ajax_is_work--;r=null}var g=e.is("img")?b._types.img_src:b._types.b_url;if(g===b._types.b_url){var w=r;if(w||(w=a(e)),void 0===b.cssobj.obj[w]||void 0===b.cssobj.obj[w][g]){b.cssobj.obj[w]={};-1!==d.indexOf(" !important")&&S.push(w)}d=d.replace(" !important","")}g!==b._types.img_src||e.attr("src")||e.attr("src","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQYV2NgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII=");var m=null,h=e.width(),v=e.height(),y=_(e,d,h,v);if(SW_BS.browser.isLocalStorageSupported&&!o&&(m=localStorage.getItem(y)))b._only_w_loaded?l(0,m,e,r,c,y):s(m,e,r);else{0===e.length&&(e=f(r.replace(/(\:| ).*$/gi,"")));var j="false",A=e.is("img")?"cover":e.css("background-size");if(u&&0===p.length&&(A="contain"),"cover"===A&&(j="true"),"cover"!==A&&"contain"!==A){var x=/^(|(\d*)(px|%|auto)) (|(\d*)(px|%|auto))$/i,B=A.match(x);null==B&&(x=/^(|(\d*)(px|%|auto))$/i,B=A.match(x));var O=!1,W=!1;if(null!=B){var R=e;g===b._types.img_src&&(R=e.parent()),"auto"!==B[3].toLowerCase()?(h=parseInt(B[2]),"%"===B[3].toLowerCase()&&(h>=100&&(j="true"),h=R.width()/100*h)):O=!0,7===B.length&&"auto"!==B[6].toLowerCase()?(v=parseInt(B[5]),"%"===B[6].toLowerCase()&&(v>=100&&(j="true"),v=R.height()/100*v)):(7===B.length||O)&&(W=!0)}O&&W&&(h=f(window).width(),v=f(window).height())}if(SW_BS.browser.isRetinaDisplay&&(h*=2,v*=2),!o){var z="tmp_width"+(u?"_c_"+c:""),I="tmp_height"+(u?"_c_"+c:""),P=parseInt(e.data(z));P||(P=0);var T=parseInt(e.data(I));if(T||(T=0),h<=P&&v<=T)return m=n(e,r),m=m.replace(" !important",""),void l(0,m,e,r,c,y);b._only_w_loaded&&(h>P?e.data(z,h):h=P,v>T?e.data(I,v):v=T)}var C=h+"x"+v;u&&0===p.length&&(e=p),b.is_init?i({fast_background:"get_cached_url",web_url:d,cover_size:j,cont_size:C,other_size:b.is_init||g===b._types.img_src?"false":"true"},function(t){l(0,t,e,r,c,y)},t):M.push({img_obj:e,fb_selector:r,fb_tmp_attr_p:c,cached_key:y,web_url:d,cover_size:j,cont_size:C,other_size:b.is_init||g===b._types.img_src?"false":"true"})}}(k=g[x].is_fb_class?g[x]:f(g[x]));if(!b.is_init){var I={web_url:"",cover_size:"",cont_size:"",other_size:""},P=[];if(!b._only_w_loaded){for(L=0;L<M.length;L++){var T=((k=M[L].img_obj).is_fb_class?k.first_elem:k).offset();!T||T.top<h||T.top>v||P.push(M[L])}var C=M.length;if(M=P,P=null,0===M.length){for(L=0;L<C;L++)r();return}b._ajax_is_work=M.length}for(var E=function(e,t){I[t]+=M[e][t]+"\n"},L=0;L<M.length;L++)for(var q in I)I.hasOwnProperty(q)&&E(L,q);I.fast_background="get_cached_urls",i(I,function(e){e=e.split("\n");for(var t=0;t<M.length;t++)l(M[t].url,e[t],M[t].img_obj,M[t].fb_selector,M[t].fb_tmp_attr_p,M[t].cached_key)},t)}}}};!function(){var e=jQuery;e(function(){e(window).on("beforeunload.fast_background",function(e){fast_background._page_unloaded=!0});var t=e(window).width();e(window).resize(function(){if(!fast_background.resize_event)return!0;var o=e(window).width();SW_BS.browser.isMobile.any&&t===o||!fast_background.is_init||-1===window.location.host.indexOf("yandex.net")&&(t=e(window).width(),fast_background.update())})})}();