/**
 * Name:    FastBackground
 * Version: 0.3.4
 * Author:  Novojilov Pavel Andreevich
 * Support: http://SHOWYWEB.ru
 * License: MIT license. http://www.opensource.org/licenses/mit-license.php
 * Copyright (c) 2017 Pavel Novojilov
 */
var fast_background={timeout:null,timeout_size:0,cssobj:null,get_selector_hook:function(a){return null},resize_event:!0,ajax_url:window.location.href,_page_unloaded:!1,_fix_old_browsers:!1,update:function(a,b,c){-1==window.location.host.indexOf("yandex.net")&&(clearTimeout(fast_background.timeout),fast_background.timeout=setTimeout(function(d){if(0==fast_background.timeout_size&&(fast_background.timeout_size=1e3),fast_background.ajax_is_work>0)return void(fast_background.timeout=setTimeout(arguments.callee.bind(this,a),fast_background.timeout_size));if(fast_background._page_unloaded=!1,"undefined"==typeof SW_BS){SW_BS={browser:{isLocalStorageSupported:"undefined"!=typeof localStorage,isMobile:{Android:function(){return navigator.userAgent.match(/Android/i)?!0:!1}(),BlackBerry:function(){return navigator.userAgent.match(/BlackBerry|BB/i)?!0:!1}(),iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)?!0:!1}(),Windows:function(){return navigator.userAgent.match(/IEMobile/i)?!0:!1}()}}};var e=SW_BS.browser;if(e.isSessionStorageSupported="undefined"!=typeof sessionStorage,e.isSessionStorageSupported)try{sessionStorage.setItem("test_sessionStorage",1),sessionStorage.removeItem("test_sessionStorage")}catch(f){e.isLocalStorageSupported=!1,e.isSessionStorageSupported=!1}e.isMobile.any=function(){return e.isMobile.Android||e.isMobile.BlackBerry||e.isMobile.iOS||e.opera_mini||e.isMobile.Windows}(),e.isMobile.anyPhone=function(){return e.isMobile.any?(navigator.userAgent.match(/iphone|ipod/i)?!0:!1)||e.isMobile.Android&&(navigator.userAgent.match(/mobile/i)?!0:!1)||e.isMobile.BlackBerry&&!(navigator.userAgent.match(/tablet/i)?!0:!1)||e.isMobile.Windows:!1}(),$("head").append('<style id="SW_BS" type="text/css"> .SW_BS_is_retina {display: none; opacity: 0; } @media only screen and (-Webkit-min-device-pixel-ratio: 1.5), only screen and (-moz-min-device-pixel-ratio: 1.5), only screen and (-o-min-device-pixel-ratio: 3 / 2), only screen and (min-device-pixel-ratio: 1.5), only screen and (-webkit-min-device-pixel-ratio: 3) {.SW_BS_is_retina {opacity: 1; }} </style>'),e.isRetinaDisplay=function(){if("undefined"==typeof $)return!1;if(e.error_css||e.isMobile.Android&&e.fullVersion<534||e.isMobile.BlackBerry&&e.fullVersion<537)return!1;$("body").append("<div id='test_SW_BS' class='is_retina'></div>");var a="1"==$("#test_.SW_BS_is_retina").css("opacity")?!0:!1;return $("#test_SW_BS").remove(),$("#SW_BS").remove(),a}()}var g=function(a,b,c){$.post(fast_background.ajax_url.replace(window.location.hash,""),a,function(a){if(!fast_background._page_unloaded){var d="<->ajax_complete<->",e=a.substring(a.length-d.length);if(e!=d)return c?c(a):console.log("ERROR POST AJAX: "+a),void b(null);a=a.substring(0,a.length-d.length),b&&b(a)}}).fail(function(d,e,f){fast_background._page_unloaded||(c?c("ERROR POST AJAX: <div style='white-space: pre-wrap; word-wrap:break-word;'>"+window.location.href+" "+($.toJSON?$.toJSON(a):"")+"</div><br>ERROR TEXT: "+f):console.log("ERROR POST AJAX: "+f),b(null))})},h={get_all:function(a){var b=a.attr("data-urls");return"undefined"==typeof b?{}:(b=b.replace(/'/gi,'"'),b=$.parseJSON(b))},get:function(a,b){var c=this.get_all(a);return c[b]},set_all:function(a,b){var c=$.toJSON(b);c=c.replace(/\"/gi,"'"),a.attr("data-urls",c),isEmptyObject(b)&&this.del_all(a)},set:function(a,b,c){var d=this.get_all(a);d[b]=c,this.set_all(a,d)},del_all:function(a){a.removeAttr("data-urls")},del:function(a,b){var c=this.get_all(a);delete c[b],this.set_all(a,c)},all_exist:function(a){var b=a.attr("data-urls");return"undefined"!=typeof b}},i=function(a,b,c){var d=new Image;d.onload=function(){b&&b()},d.onerror=function(a){return a.preventDefault(),a.stopPropagation(),c&&c(),!1},d.src=a},j=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a,b){window.setTimeout(a,1e3/60)}}();null===fast_background.cssobj&&(fast_background.cssobj=cssobj({}));var k=$(".fast_background").toArray();k.length<1&&a&&a();var l=function(a,b){var c=fast_background.get_selector_hook(a,b);return c||(c=a.attr("id"),c&&(c="#"+c)),c||(c=a.is("body")?"fb_body":"fb_"+Math.random().toString(36).substr(2,9),a.attr("id",c),c="#"+c),c},m=function(b,c,d){var e=c.is("img")?fast_background.types.img_src:fast_background.types.b_url;try{switch(e){case fast_background.types.b_url:var f=d;f||(f=l(c)),"undefined"==typeof fast_background.cssobj.obj[f]&&(fast_background.cssobj.obj[f]={});var g=fast_background.cssobj.obj[f][e]&&-1!==fast_background.cssobj.obj[f][e].indexOf(" !important");fast_background.cssobj.obj[f][e]="url("+b+")"+(g?" !important":""),fast_background.cssobj.update(),g||(fast_background._fix_old_browsers||"none"!=$(f).css("background-image")||(fast_background._fix_old_browsers=!0),fast_background._fix_old_browsers&&(fast_background.cssobj.obj[f].backgroundImage="url("+b+")",fast_background.cssobj.update()));break;case fast_background.types.img_src:c.attr(e,b),j(function(){var a=$(window).width(),b=c.width();(b>a||SW_BS.browser.isMobile.anyPhone&&10>b)&&c.css("width","100%")},c[0])}}catch(h){}fast_background.ajax_is_work--,fast_background.ajax_is_work<1&&(fast_background.is_init?a&&a():(fast_background.is_init=!0,fast_background.update(a)))},n=function(b,c){var d=b.is("img")?fast_background.types.img_src:fast_background.types.b_url;switch(d){case fast_background.types.b_url:var e=c?c:"#"+b.attr("id");"undefined"==typeof fast_background.cssobj.obj[e]&&(fast_background.cssobj.obj[e]={});var f=fast_background.cssobj.obj[e][d]&&-1!==fast_background.cssobj.obj[e][d].indexOf(" !important");fast_background.cssobj.obj[e][d]="none"+(f?" !important":""),fast_background.cssobj.update();break;case fast_background.types.img_src:b.attr(d,"")}fast_background.ajax_is_work--,fast_background.ajax_is_work<1&&(fast_background.is_init?a&&a():(fast_background.is_init=!0,fast_background.update(a)))},o=function(a,b,c,d){if(SW_BS.browser.isLocalStorageSupported&&fast_background.is_init){var e="fast_background_cached_url_"+a;localStorage.setItem(e,b)}i(b,function(){m(b,c,d)},function(){n(c,d)})};fast_background.ajax_is_work=k.length;for(var p=0;p<k.length;p++){var q=k[p].is_fb_class?k[p]:$(k[p]);!function(a){var d=null;if(!a.is_fb_class&&h.all_exist(a)){var e=h.get_all(a);for(var f in e)if(e.hasOwnProperty(f)){var i=e[f],j=l(a,!0);d=j+" "+f;var m=$(d);m.length>0&&(m=m.eq(0)),k.push({is_fb_class:!0,first_elem:m,url:i,fb_selector:d}),fast_background.ajax_is_work++}}var n=null,p=!1,r=null;if(a.is_fb_class)p=!0,r=q.first_elem,n=a.url,d=a.fb_selector,a=a.first_elem;else{if(n=a.attr("data-url"),!n)return void fast_background.ajax_is_work--;d=null}var s=a.is("img")?fast_background.types.img_src:fast_background.types.b_url;if(s==fast_background.types.b_url){var t=d;if(t||(t=l(a)),"undefined"==typeof fast_background.cssobj.obj[t]||"undefined"==typeof fast_background.cssobj.obj[t][s]){fast_background.cssobj.obj[t]={},fast_background.cssobj.obj[t][s]={};var u=-1!==n.indexOf(" !important");fast_background.cssobj.obj[t][s]="none"+(u?" !important":"")}n=n.replace(" !important","")}s!=fast_background.types.img_src||a.attr("src")||a.attr("src","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQYV2NgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII=");var v=null;if(SW_BS.browser.isLocalStorageSupported&&!fast_background.is_init&&(v=localStorage.getItem("fast_background_cached_url_"+n)))return void o(n,v,a,d);0==a.length&&(a=$(d.split(" ")[0]));var w="false",x=a.is("img")?"contain":a.css("background-size");p&&0==r.length&&(x="contain"),"cover"==x&&(w="true");var y=a.width(),z=a.height();if("cover"!==x&&"contain"!==x){var A=/^(|(\d*)(px|%|auto)) (|(\d*)(px|%|auto))$/i,B=x.match(A);null==B&&(A=/^(|(\d*)(px|%|auto))$/i,B=x.match(A));var C=!1,D=!1;if(null!=B){var E=a;s==fast_background.types.img_src&&(E=a.parent()),"auto"!=B[3].toLowerCase()?(y=parseInt(B[2]),"%"==B[3].toLowerCase()&&(y>=100&&(w="true"),y=E.width()/100*y)):C=!0,7==B.length&&"auto"!=B[6].toLowerCase()?(z=parseInt(B[5]),"%"==B[6].toLowerCase()&&(z>=100&&(w="true"),z=E.height()/100*z)):(7==B.length||C)&&(D=!0)}C&&D&&(y=$(window).width(),z=$(window).height())}if(SW_BS.browser.isRetinaDisplay&&(y*=2,z*=2),y+=150,z+=150,!c){var F=parseInt(a.data("tmp_width"+(p?"_c":"")));F||(F=0);var G=parseInt(a.data("tmp_height"+(p?"_c":"")));if(G||(G=0),F>=y&&G>=z&&SW_BS.browser.isLocalStorageSupported&&(v=localStorage.getItem("fast_background_cached_url_"+n),p&&0==r.length&&(a=r),v))return void o(n,v,a,d);y>F?a.data("tmp_width"+(p?"_c":""),y):y=F,z>G?a.data("tmp_height"+(p?"_c":""),z):z=G}var H=y+"x"+z;p&&0==r.length&&(a=r),g({fast_background:"get_cached_url",web_url:n,cover_size:w,cont_size:H,other_size:fast_background.is_init?"false":"true"},function(b){o(n,b,a,d)},b)}(q)}}.bind(this,a,b,c),fast_background.timeout_size))},types:{b_url:"background-image",img_src:"src"},is_init:!1,ajax_is_work:0};$(function(){$(window).on("beforeunload.fast_background",function(a){fast_background._page_unloaded=!0});var a=$(window).width();$(window).resize(function(){if(!fast_background.resize_event)return!0;var b=$(window).width();SW_BS.browser.isMobile.any&&a==b||!fast_background.is_init||-1==window.location.host.indexOf("yandex.net")&&(a=$(window).width(),fast_background.update())})});