/**
 * Name:    FastBackground
 * Version: 0.6.0
 * Author:  Novojilov Pavel Andreevich
 * Support: http://SHOWYWEB.ru
 * License: MIT license. http://www.opensource.org/licenses/mit-license.php
 * Copyright (c) 2017 Pavel Novojilov
 */
var fast_background={timeout:null,timeout_size:0,cssobj:null,prepare_selector_hook:function(a){return a},resize_event:!0,ajax_url:window.location.href,max_stream:5,_page_unloaded:!1,_fix_old_browsers:!1,update:function(a,t,e){if(-1==window.location.host.indexOf("yandex.net")){var o=[];clearTimeout(fast_background.timeout),fast_background.timeout=setTimeout(function(){if(0==fast_background.timeout_size&&(fast_background.timeout_size=1e3),fast_background.ajax_is_work>0)fast_background.timeout=setTimeout(arguments.callee.bind(this,a),fast_background.timeout_size);else{if(fast_background._page_unloaded=!1,"undefined"==typeof SW_BS){SW_BS={browser:{isLocalStorageSupported:"undefined"!=typeof localStorage,isMobile:{Android:!!navigator.userAgent.match(/Android/i),BlackBerry:!!navigator.userAgent.match(/BlackBerry|BB/i),iOS:!!navigator.userAgent.match(/iPhone|iPad|iPod/i),Windows:!!navigator.userAgent.match(/IEMobile/i)}}};var r=SW_BS.browser;if(r.isSessionStorageSupported="undefined"!=typeof sessionStorage,r.isSessionStorageSupported)try{sessionStorage.setItem("test_sessionStorage",1),sessionStorage.removeItem("test_sessionStorage")}catch(a){r.isLocalStorageSupported=!1,r.isSessionStorageSupported=!1}r.isMobile.any=r.isMobile.Android||r.isMobile.BlackBerry||r.isMobile.iOS||r.opera_mini||r.isMobile.Windows,r.isMobile.anyPhone=!!r.isMobile.any&&(!!navigator.userAgent.match(/iphone|ipod/i)||r.isMobile.Android&&!!navigator.userAgent.match(/mobile/i)||r.isMobile.BlackBerry&&!!!navigator.userAgent.match(/tablet/i)||r.isMobile.Windows),$("head").append('<style id="SW_BS" type="text/css"> .SW_BS_is_retina {display: none; opacity: 0; } @media only screen and (-Webkit-min-device-pixel-ratio: 1.5), only screen and (-moz-min-device-pixel-ratio: 1.5), only screen and (-o-min-device-pixel-ratio: 3 / 2), only screen and (min-device-pixel-ratio: 1.5), only screen and (-webkit-min-device-pixel-ratio: 3) {.SW_BS_is_retina {opacity: 1; }} </style>'),r.isRetinaDisplay=function(){if("undefined"==typeof $)return!1;if(r.error_css||r.isMobile.Android&&r.fullVersion<534||r.isMobile.BlackBerry&&r.fullVersion<537)return!1;$("body").append("<div id='test_SW_BS' class='is_retina'></div>");var a="1"==$("#test_.SW_BS_is_retina").css("opacity");return $("#test_SW_BS").remove(),$("#SW_BS").remove(),a}()}var i=function(a,t,e){$.post(fast_background.ajax_url.replace(window.location.hash,""),a,function(a){if(!fast_background._page_unloaded){var o="<->ajax_complete<->";if(a.substring(a.length-o.length)!=o)return e?e(a):console.log("ERROR POST AJAX: "+a),void t(null);a=a.substring(0,a.length-o.length),t&&t(a)}}).fail(function(o,r,i){fast_background._page_unloaded||(e?e("ERROR POST AJAX: <div style='white-space: pre-wrap; word-wrap:break-word;'>"+window.location.href+" "+($.toJSON?$.toJSON(a):"")+"</div><br>ERROR TEXT: "+i):console.log("ERROR POST AJAX: "+i),t(null))})},s={get_all:function(a){var t=a.attr("data-urls");return void 0===t?{}:(t=t.replace(/'/gi,'"'),t=$.parseJSON(t))},get:function(a,t){return this.get_all(a)[t]},set_all:function(a,t){var e=$.toJSON(t);e=e.replace(/\"/gi,"'"),a.attr("data-urls",e),isEmptyObject(t)&&this.del_all(a)},set:function(a,t,e){var o=this.get_all(a);o[t]=e,this.set_all(a,o)},del_all:function(a){a.removeAttr("data-urls")},del:function(a,t){var e=this.get_all(a);delete e[t],this.set_all(a,e)},all_exist:function(a){return void 0!==a.attr("data-urls")}},n=0,c=function(a,t,e){if(n>fast_background.max_stream)setTimeout(arguments.callee.bind(this,a,t,e),100);else{n++;var o=new Image;o.onload=function(){n--,t&&t()},o.onerror=function(a){return n--,a.preventDefault(),a.stopPropagation(),e&&e(),!1},o.src=a}},d=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a,t){window.setTimeout(a,1e3/60)};null===fast_background.cssobj&&(fast_background.cssobj=cssobj({}));var _=$(".fast_background").toArray();_.length<1&&a&&a();var u=function(a,t){var e=a.attr("id");return e&&(e="#"+e),e||(e=a.is("body")?"fb_body":"fb_"+Math.random().toString(36).substr(2,9),a.attr("id",e),e="#"+e),t&&(e=e+(0===t.indexOf(":")?"":" ")+t),e=fast_background.prepare_selector_hook(e)},l=function(t,e,r){var i=e.is("img")?fast_background.types.img_src:fast_background.types.b_url;try{switch(i){case fast_background.types.b_url:var s=r;s||(s=u(e)),void 0===fast_background.cssobj.obj[s]&&(fast_background.cssobj.obj[s]={});var n=fast_background.cssobj.obj[s][i]&&-1!==fast_background.cssobj.obj[s][i].indexOf(" !important");n||-1===o.indexOf(s)||(n=!0),fast_background.cssobj.obj[s][i]="url("+t+")"+(n?" !important":""),fast_background.cssobj.update(),n||(fast_background._fix_old_browsers||"none"!=$(s).css("background-image")||(fast_background._fix_old_browsers=!0),fast_background._fix_old_browsers&&(fast_background.cssobj.obj[s].backgroundImage="url("+t+")",fast_background.cssobj.update()));break;case fast_background.types.img_src:e.attr(i,t),d(function(){var a=$(window).width(),t=e.width();(a>500&&t>a||SW_BS.browser.isMobile.anyPhone&&t<10)&&e.css("width","100%")},e[0])}}catch(a){}fast_background.ajax_is_work--,fast_background.ajax_is_work<1&&(fast_background.is_init?a&&a():(fast_background.is_init=!0,fast_background.update(a)))},b=function(t,e){var o=t.is("img")?fast_background.types.img_src:fast_background.types.b_url;switch(o){case fast_background.types.b_url:var r=e;r||(r=u(t)),void 0===fast_background.cssobj.obj[r]?fast_background.cssobj.obj[r]={}:delete fast_background.cssobj.obj[r][o],fast_background.cssobj.update();break;case fast_background.types.img_src:t.attr(o,"")}fast_background.ajax_is_work--,fast_background.ajax_is_work<1&&(fast_background.is_init?a&&a():(fast_background.is_init=!0,fast_background.update(a)))},g=function(a,t,e,o){if(SW_BS.browser.isLocalStorageSupported&&fast_background.is_init){var r="fast_background_cached_url_"+a;localStorage.setItem(r,t)}c(t,function(){l(t,e,o)},function(){b(e,o)})};fast_background.ajax_is_work=_.length;for(var f=0;f<_.length;f++){var p=_[f].is_fb_class?_[f]:$(_[f]);!function(a){var r=null;if(!a.is_fb_class&&s.all_exist(a)){var n=s.get_all(a);for(var c in n)if(n.hasOwnProperty(c)){var d=n[c];r=u(a,c);var l=$(r.replace(":hover","").replace(":active","").replace(":focus",""));l.length>0&&(l=l.eq(0)),_.push({is_fb_class:!0,first_elem:l,url:d,fb_selector:r}),fast_background.ajax_is_work++}}var b=null,f=!1,k=null;if(a.is_fb_class)f=!0,k=p.first_elem,b=a.url,r=a.fb_selector,a=a.first_elem;else{if(!(b=a.attr("data-url")))return void fast_background.ajax_is_work--;r=null}var w=a.is("img")?fast_background.types.img_src:fast_background.types.b_url;if(w==fast_background.types.b_url){var m=r;m||(m=u(a)),void 0!==fast_background.cssobj.obj[m]&&void 0!==fast_background.cssobj.obj[m][w]||(fast_background.cssobj.obj[m]={},-1!==b.indexOf(" !important")&&o.push(m)),b=b.replace(" !important","")}w!=fast_background.types.img_src||a.attr("src")||a.attr("src","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQYV2NgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII=");var h=null;if(SW_BS.browser.isLocalStorageSupported&&!fast_background.is_init&&(h=localStorage.getItem("fast_background_cached_url_"+b)))g(b,h,a,r);else{0==a.length&&(a=$(r.replace(/(\:| ).*$/gi,"")));var v="false",S=a.is("img")?"contain":a.css("background-size");f&&0==k.length&&(S="contain"),"cover"==S&&(v="true");var A=a.width(),y=a.height();if("cover"!==S&&"contain"!==S){var j=/^(|(\d*)(px|%|auto)) (|(\d*)(px|%|auto))$/i,x=S.match(j);null==x&&(j=/^(|(\d*)(px|%|auto))$/i,x=S.match(j));var B=!1,O=!1;if(null!=x){var W=a;w==fast_background.types.img_src&&(W=a.parent()),"auto"!=x[3].toLowerCase()?(A=parseInt(x[2]),"%"==x[3].toLowerCase()&&(A>=100&&(v="true"),A=W.width()/100*A)):B=!0,7==x.length&&"auto"!=x[6].toLowerCase()?(y=parseInt(x[5]),"%"==x[6].toLowerCase()&&(y>=100&&(v="true"),y=W.height()/100*y)):(7==x.length||B)&&(O=!0)}B&&O&&(A=$(window).width(),y=$(window).height())}if(SW_BS.browser.isRetinaDisplay&&(A*=2,y*=2),A+=150,y+=150,!e){var R=parseInt(a.data("tmp_width"+(f?"_c":"")));R||(R=0);var M=parseInt(a.data("tmp_height"+(f?"_c":"")));if(M||(M=0),A<=R&&y<=M&&SW_BS.browser.isLocalStorageSupported&&(h=localStorage.getItem("fast_background_cached_url_"+b),f&&0==k.length&&(a=k),h))return void g(b,h,a,r);A>R?a.data("tmp_width"+(f?"_c":""),A):A=R,y>M?a.data("tmp_height"+(f?"_c":""),y):y=M}var z=A+"x"+y;f&&0==k.length&&(a=k),i({fast_background:"get_cached_url",web_url:b,cover_size:v,cont_size:z,other_size:fast_background.is_init?"false":"true"},function(t){g(b,t,a,r)},t)}}(p)}}}.bind(this,a,t,e),fast_background.timeout_size)}},types:{b_url:"background-image",img_src:"src"},is_init:!1,ajax_is_work:0};$(function(){$(window).on("beforeunload.fast_background",function(a){fast_background._page_unloaded=!0});var a=$(window).width();$(window).resize(function(){if(!fast_background.resize_event)return!0;var t=$(window).width();SW_BS.browser.isMobile.any&&a==t||!fast_background.is_init||-1==window.location.host.indexOf("yandex.net")&&(a=$(window).width(),fast_background.update())})});